<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Elasticsearch Tips &#8211; Part 1: Getting Started</title>

<link rel="stylesheet" href="../../../../wp-content/themes/LokuTech/style.css" type="text/css" media="all" />
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="pingback" href="http://tech.loku.com/xmlrpc.php" />

<meta name="generator" content="WordPress 3.2.1" />
<meta name="template" content="Hybrid 0.9" />
<meta name="robots" content="index,follow" />
<meta name="author" content="Brian" />
<meta name="copyright" content="Copyright (c) November 2011" />
<meta name="revised" content="Friday, November 18th, 2011, 6:51 pm" />
<meta name="description" content="Need help getting started with elasticsearch? This post will help you avoid some common mistakes" />
<meta name="keywords" content="elasticsearch, lucene, python, django, tips, getting started" />
<link rel="alternate" type="application/rss+xml" title="Loku Tech &raquo; Feed" href="http://tech.loku.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Loku Tech &raquo; Comments Feed" href="http://tech.loku.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Loku Tech &raquo; Elasticsearch Tips &#8211; Part 1: Getting Started Comments Feed" href="http://tech.loku.com/2011/11/18/elasticsearch-tips-part-1-getting-started/feed/" />
<link rel='stylesheet' id='mr_social_sharing-css'  href='../../../../wp-content/plugins/social-sharing-toolkit/style.css%3Fver=3.2.1.css' type='text/css' media='all' />
<script type='text/javascript' src='../../../../wp-includes/js/l10n.js%3Fver=20101110'></script>
<script type='text/javascript' src='../../../../wp-includes/js/prototype.js%3Fver=1.6.1'></script>
<script type='text/javascript' src='../../../../wp-includes/js/scriptaculous/wp-scriptaculous.js%3Fver=1.8.3'></script>
<script type='text/javascript' src='../../../../wp-includes/js/scriptaculous/effects.js%3Fver=1.8.3'></script>
<script type='text/javascript' src='../../../../wp-content/plugins/lightbox-2/lightbox-resize.js%3Fver=1.8'></script>
<script type='text/javascript' src='../../../../wp-includes/js/comment-reply.js%3Fver=20090102'></script>
<script type='text/javascript' src='../../../../wp-includes/js/jquery/jquery.js%3Fver=1.6.1'></script>
<script type='text/javascript' src='../../../../wp-content/plugins/social-sharing-toolkit/script.js%3Fver=3.2.1'></script>
<script type='text/javascript' src='../../../../wp-content/plugins/social-sharing-toolkit/googleplus.js.php%3Flang=en_US&amp;ver=3.2.1'></script>
<script type='text/javascript' src='../../../../../apis.google.com/js/plusone.js%3Fver=3.2.1'></script>
<script type='text/javascript' src='../../../../../platform.twitter.com/widgets.js%3Fver=3.2.1'></script>
<script type='text/javascript' src='../../../../wp-content/plugins/google-analyticator/external-tracking.min.js%3Fver=6.2'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://tech.loku.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://tech.loku.com/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='Loku Tech' href='http://tech.loku.com/' />
<link rel='start' title='Loku’s technology brings local online' href='http://tech.loku.com/2011/08/02/borrowed-sugar%e2%80%99s-technology-brings-local-online/' />
<link rel='prev' title='Data Warehousing To Big Data' href='http://tech.loku.com/2011/11/17/data-warehousing-to-big-data/' />
<link rel='next' title='What the hell is Big Data for Local?' href='http://tech.loku.com/2011/12/04/what-the-hell-is-big-data-for-local/' />
<link rel='canonical' href='index.html' />
<link rel='shortlink' href='http://tech.loku.com/?p=122' />

	<!-- begin lightbox scripts -->
	<script type="text/javascript">
    //<![CDATA[
    document.write('<link rel="stylesheet" href="http://tech.loku.com/wp-content/plugins/lightbox-2/Themes/Black/lightbox.css" type="text/css" media="screen" />');
    //]]>
    </script>
	<!-- end lightbox scripts -->
<!-- Google Analytics Tracking by Google Analyticator 6.2: http://ronaldheft.com/code/analyticator/ -->
<script type="text/javascript">
	var analyticsFileTypes = [''];
	var analyticsEventTracking = 'enabled';
</script>
<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-25086087-1']);
	_gaq.push(['_trackPageview']);
	_gaq.push(['_trackPageLoadTime']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
</script>

</head>

<body class="wordpress ltr en_US y2012 m11 d21 h06 wednesday logged-out singular singular-post singular-post-122 single-122 primary-active secondary-active subsidiary-inactive">


<div id="body-container">

	
	<div id="header-container">

		<div id="header">

			<div id="site-title"><a href="http://tech.loku.com" title="Loku Tech" rel="home"><span>Loku Tech</span></a></div>
		</div><!-- #header -->

	</div><!-- #header-container -->

	
	<div id="container">

		
	<div id="content" class="hfeed content">

		<div class="breadcrumb breadcrumbs"><div class="breadcrumb-trail"><span class="trail-before"><span class="breadcrumb-title">Browse:</span></span> <a href="http://tech.loku.com" title="Loku Tech" rel="home" class="trail-begin">Home</a> <span class="sep">/</span> <a href="http://tech.loku.com/2011/" title="2011">2011</a> <span class="sep">/</span> <a href="http://tech.loku.com/2011/11/" title="November 2011">November</a> <span class="sep">/</span> <a href="http://tech.loku.com/2011/11/18/" title="November 18, 2011">18</a> <span class="sep">/</span> <span class="trail-end">Elasticsearch Tips &#8211; Part 1: Getting Started</span></div></div>
		
			<div id="post-122" class="hentry post publish post-1 odd author-brian category-loku-tech">

				<h1 class="post-title entry-title"><a href="index.html" title="Elasticsearch Tips &#8211; Part 1: Getting Started" rel="bookmark">Elasticsearch Tips &#8211; Part 1: Getting Started</a></h1><p class="byline">By <span class="author vcard"><a class="url fn n" href="http://tech.loku.com/author/brian/" title="Brian">Brian</a></span> on <abbr class="published" title="Friday, November 18th, 2011, 6:51 pm">November 18, 2011</abbr> </p>
				<div class="entry-content">
					<div>
<p>One of the key open source projects that we use to make Loku run is <a href="http://tech.loku.com/2011/11/18/elasticsearch-tips-part-1-getting-started/(http://www.elasticsearch.org/)">elasticsearch</a>. My words can’t really do it justice, so I will let the creators explain it:</p>
<blockquote>
<p style="text-align: left;">So, we build a web site or an application and want to add search to it, and then it hits us:</p>
<p style="text-align: left;"><strong>getting search working is hard</strong>. We want our search solution to be <strong>fast</strong>, we want a <strong>painless setup</strong> and a completely <strong>free search schema</strong>, we want to be able to index data simply using <strong>JSON over HTTP</strong>, we want our search server to be <strong>always available</strong>, we want to be able to start with one machine and <strong>scale to hundreds</strong>, we want <strong>real-time search</strong>, we want simple <strong>multi-tenancy</strong>, and we want a solution that is <strong>built for the cloud</strong>.</p>
<p style="text-align: left;" dir="ltr"><strong>&#8220;This should be easier&#8221;</strong>, we declared,<strong> &#8220;and cool, bonsai cool&#8221;</strong>.</p>
<p style="text-align: left;" dir="ltr"><strong>elasticsearch</strong> aims to solve all these problems and more. It is an Open Source (Apache 2), Distributed, RESTful, Search Engine built on top of <a href="http://lucene.apache.org/">Apache Lucene</a>.</p>
</blockquote>
</div>
<div><span id="more-122"></span></div>
<p>Sounds great, right? It is! elasticsearch is one of the best, easiest, most versatile technologies that I have ever used. The JSON emphasis is perfect for integration with websites and the quick set up time makes it easy to decide if it’s for you.However, I was frustrated with elasticsearch when I first started. It didn’t fit with my current thinking of the problem, it was doing things that I didn’t expect, and I was having trouble getting the speed fast enough to have into production. It was enough to make me almost lose it and give up.</p>
<div><img class="alignnone" title="Frustration sets In" src="../../../../../loku-tech-blog.s3.amazonaws.com/Angry-At-Computer.jpg" alt="Ever had one of those days?" width="360" height="238" /></div>
<div>
<p>After powering through this, though. I realized that the problem was with me and my thinking, not elasticsearch. Hopefully I can pass this knowledge off to others so that they can get started faster. Let’s start with a few simple points&#8230;</p>
<h3>It’s an <a href="http://en.wikipedia.org/wiki/Index_(search_engine)">Index</a>, not a <a href="http://en.wikipedia.org/wiki/Relational_database">Relational Database</a></h3>
<p>I’m always running into this problem, especially in my own thinking. It’s not an easy process to traverse links in the indexed data, and wrong to try to query based on data in related items.</p>
<p dir="ltr">Coming from a heavy <a href="http://python.org/">python</a>/<a href="https://www.djangoproject.com/">django</a> background, the switch took me some time to wrap my head around. In a database like ours, the most effective solution to most managment issues is to have one and only one place that the data is stored, leading to highly <a href="http://en.wikipedia.org/wiki/Database_normalization">normalized</a> structures. On the index, we push the relevant data from related models out to the item model, leading to a highly <a href="http://tech.loku.com/2011/11/18/elasticsearch-tips-part-1-getting-started/(http://en.wikipedia.org/wiki/Denormalization)">denormalized</a> structure.</p>
<p dir="ltr">How does this affect maintainability? Well, let’s just say that if Austin changed it’s name to Ficus, it would be easy to update the database, and hard to update the index.</p>
<p dir="ltr">I’ve found some patterns emerge in my code that seem to suggest a pairing of RDB and Index might be desirable for a query execution pipeline, but that is a topic for another post.</p>
<h3 dir="ltr">Fully define your data types, including analyzer</h3>
<p dir="ltr"><span class="Apple-style-span" style="font-size: 13px; font-weight: normal;">This is the bane of the novice elasticsearch programmer. The index is taking some data and implicitly analyzing it, or typing it, and it is not the type you meant. In the early prototyping days, I spent many hours on this very problem.</span></p>
<p dir="ltr"><span class="Apple-style-span" style="font-size: 13px; font-weight: normal;">It’s not just a problem of defining the type either, it is a matter of analysis. In elasticsearch, analyzers are what runs on the items to make the data that is used to access the items at query time. <a href="http://www.elasticsearch.org/guide/reference/index-modules/analysis/)">Here</a> </span><span class="Apple-style-span" style="font-size: 13px; font-weight: normal;">are all the analyzers built into elasticsearch and a very in-depth explanation of the analysis structure and how you can use this structure to build custom analyzers.</span></p>
<p dir="ltr"><span class="Apple-style-span" style="font-size: 13px; font-weight: normal;">While this is great, 95% of what you would need to do can be handled by the built-in analyzers, provided you know exactly what to expect from them.</span></p>
<p dir="ltr"><span class="Apple-style-span" style="font-size: 13px; font-weight: normal;">The <a href="http://www.elasticsearch.org/guide/reference/index-modules/analysis/standard-analyzer.html">standard analyzer</a></span><span class="Apple-style-span" style="font-size: 13px; font-weight: normal;"> is great for most things, but if you are going to use the index to serve user queries, I would use the <a href="http://www.elasticsearch.org/guide/reference/index-modules/analysis/snowball-analyzer.html">snowball analyzer</a></span><span class="Apple-style-span" style="font-size: 13px; font-weight: normal;"> instead. It uses <a href="http://snowball.tartarus.org/">Snowball</a></span><span class="Apple-style-span" style="font-size: 13px; font-weight: normal;"> to do stemming and will pull out what your user is really searching for more than the others. For example, “taco” and “tacos” return different results using the standard analyzer, but the same results when using snowball.</span></p>
<p dir="ltr"><span class="Apple-style-span" style="font-size: 13px; font-weight: normal;">If you need to query for an exact full-string match all the time, use the <a href="http://www.elasticsearch.org/guide/reference/index-modules/analysis/keyword-analyzer.html">keyword analyzer</a></span><span class="Apple-style-span" style="font-size: 13px; font-weight: normal;">. It takes the whole string as a single token, good for city names, tags, keywords, names, places, etc.</span></p>
<p dir="ltr"><span class="Apple-style-span" style="font-size: 13px; font-weight: normal;">If you will never need to query the data, then don’t analyze it. It wastes space and time. If there is a storage data structure that has no data relevant to queries, set it’s analyzer as not analyzed. It makes looking at your schema mapping later much easier to comprehend, which is a great help when debugging queries. If you are unsure if you will need the data, I would let elasticsearch use its defaults. Better safe than sorry.</span></p>
<h3 dir="ltr">Query operations have a cost</h3>
<p dir="ltr">This is something that can really affect your query time, and server load if managed improperly. Simply stated: Run the most expensive operations on the smallest data sets possible. Simple in theory, but difficult in practice.</p>
<p dir="ltr">Say you wanted to, for example, wanted to find items that had a pin within a bounding box, given that the bounding box would never be the same, but would usually be smaller than a city. The simplest way to do it would be an <a href="http://www.elasticsearch.org/guide/reference/query-dsl/geo-bounding-box-filter.html">geo_bb filter</a>. Good, simple, easy to implement, but slow. See, the results of this query are not cached, meaning that the work is always done over all the data every hit. Moreover, caching this query would be ever worse, since the bounding box would never be the same and we would always have a cache miss. What to do&#8230;</p>
<p dir="ltr">Expand the box. If we know that the box will be less than a city, we know that usually, a user’s results will come from a single city. So, if we know the general size and center of the city, we could use a <a href="http://www.elasticsearch.org/guide/reference/query-dsl/geo-distance-filter.html">geo distance filter</a> for the size of the city, cache the results, and use that filter on our query as well as the bounding box. This cuts down the expensive geo comparison to only things within the city, not to everything, which speeds up your query.</p>
<p dir="ltr">The same principle can be applied to <a href="http://www.elasticsearch.org/guide/reference/query-dsl/custom-score-query.html">script score computation</a>. For example, if you have a script that boosts by how recent an article is, why even have it run on an article it would give a boost of less than .0001? or, if boosting based on a user input, why even compute the boost for factors who would influence the score only 1% as much as another factor?</p>
<p dir="ltr">Most of this doesn’t come into play if you are doing text only, though. elasticsearch is amazing at text. My personal favorite is the <a href="http://www.elasticsearch.org/guide/reference/query-dsl/mlt-query.html">more like this query</a> and all the fun fuzzy matching you can do with it to get out related sets of items. But more on that later.</p>
<p>Hopefully these tips help you get started with your own elasticsearch adventure and avoid some of the pitfalls that slowed me down when I started. Until next time&#8230;</p>
</div>

				<!-- Social Sharing Toolkit v2.0.4 | http://www.marijnrongen.com/wordpress-plugins/social_sharing_toolkit/ -->
				<div class="mr_social_sharing_wrapper"><span class="mr_social_sharing_top"><iframe src="https://www.facebook.com/plugins/like.php?locale=en_US&amp;href=http%3A%2F%2Ftech.loku.com%2F2011%2F11%2F18%2Felasticsearch-tips-part-1-getting-started%2F&amp;layout=button_count&amp;show_faces=false&amp;width=90px&amp;height=21px" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:90px; height:21px;" allowTransparency="true"></iframe></span><span class="mr_social_sharing_top"><a href="http://twitter.com/share" class="twitter-share-button" data-url="http://tech.loku.com/2011/11/18/elasticsearch-tips-part-1-getting-started/" data-count="horizontal" data-via="loku" data-text="Elasticsearch Tips – Part 1: Getting Started">Tweet</a></span><span class="mr_social_sharing_top"><g:plusone size="medium" href="http://tech.loku.com/2011/11/18/elasticsearch-tips-part-1-getting-started/"></g:plusone></span></div>									</div><!-- .entry-content -->

				<p class="entry-meta"><span class="category"><span class="before">Posted in </span><a href="http://tech.loku.com/category/loku-tech/" rel="tag">Loku tech</a></span>  | <a class="comments-link" href="index.html#respond" title="Comment on Elasticsearch Tips &#8211; Part 1: Getting Started">Leave a response</a></p>
			</div><!-- .hentry -->

			
			
<div id="comments-template">

	
		
	
									<div id="respond">
				<h3 id="reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="index.html#respond" style="display:none;">Click here to cancel reply.</a></small></h3>
									<form action="http://tech.loku.com/wp-comments-post.php" method="post" id="commentform">
																										<p class="form-author req"><label for="author">Name <span class="required">*</span> </label> <input type="text" class="text-input" name="author" id="author" value="" size="40" /></p>
<p class="form-email req"><label for="email">Email <span class="required">*</span> </label> <input type="text" class="text-input" name="email" id="email" value="" size="40" /></p>
<p class="form-url"><label for="url">Website</label><input type="text" class="text-input" name="url" id="url" value="" size="40" /></p>
												<p class="form-textarea req"><label for="comment">Comment</label><textarea name="comment" id="comment" cols="60" rows="10"></textarea></p>												<p class="form-submit">
							<input name="submit" type="submit" id="submit" value="Post Comment" />
							<input type='hidden' name='comment_post_ID' value='122' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
						</p>
											</form>
							</div><!-- #respond -->
						
</div><!-- #comments-template -->
			
		
		
	
		<div class="navigation-links">
			<a href="http://tech.loku.com/2011/11/17/data-warehousing-to-big-data/" rel="prev"><span class="previous">&laquo; Previous</span></a>			<a href="http://tech.loku.com/2011/12/04/what-the-hell-is-big-data-for-local/" rel="next"><span class="next">Next &raquo;</span></a>		</div><!-- .navigation-links -->

	
	</div><!-- .content .hfeed -->

		
	<div id="primary" class="sidebar aside">

		
		<div id="text-3" class="widget widget_text widget-widget_text"><div class="widget-wrap widget-inside">			<div class="textwidget"><a href="http://loku.com">
<img src="../../../../../tech.borrowedsugar.com/wp-content/uploads/2011/08/back-to-Loku.png" width="162" height="49" border="0" alt="Back to Loku" />
</a></div>
		</div></div><div id="text-4" class="widget widget_text widget-widget_text"><div class="widget-wrap widget-inside"><h3 class="widget-title">MORE LOKU</h3>			<div class="textwidget"><div>
	<span class="more-loku-icons">
		<a href="http://www.facebook.com/pages/Loku/128298127262151" target="_blank"> 
			<img src="../../../../wp-content/uploads/2011/08/facebook.png" alt="Facebook"> 
		</a>  
	</span>
	<span class="more-loku-icons">
		<a href="http://twitter.com/#!/lokutech" target="_blank"> <img src="../../../../wp-content/uploads/2011/08/twitter.png" alt="Twitter"> 
		</a>
	</span>
	<span class="more-loku-icons">
		<a href="http://feeds.feedburner.com/LokuTech" target="_blank"> <img src="../../../../wp-content/uploads/2011/08/rss-1.png" alt="RSS" >
		</a>
	</span>
	</span>
</div></div>
		</div></div>
		
	</div><!-- #primary .aside -->


	<div id="secondary" class="sidebar aside">

		
		<div id="hybrid-categories-3" class="widget categories widget-categories"><div class="widget-wrap widget-inside"><h3 class="widget-title">CATEGORIES</h3><ul class="xoxo categories"><li class="cat-item cat-item-4"><a href="http://tech.loku.com/category/loku-tech/" title="View all posts filed under Loku tech">Loku tech</a></li></ul><!-- .xoxo .categories --></div></div><div id="hybrid-archives-3" class="widget archives widget-archives"><div class="widget-wrap widget-inside"><h3 class="widget-title">ARCHIVES</h3><ul class="xoxo archives"><li><a href='http://tech.loku.com/2012/05/' title='May 2012'>May 2012</a></li><li><a href='http://tech.loku.com/2012/04/' title='April 2012'>April 2012</a></li><li><a href='http://tech.loku.com/2012/03/' title='March 2012'>March 2012</a></li><li><a href='http://tech.loku.com/2012/02/' title='February 2012'>February 2012</a></li><li><a href='http://tech.loku.com/2012/01/' title='January 2012'>January 2012</a></li><li><a href='http://tech.loku.com/2011/12/' title='December 2011'>December 2011</a></li><li><a href='http://tech.loku.com/2011/11/' title='November 2011'>November 2011</a></li><li><a href='http://tech.loku.com/2011/08/' title='August 2011'>August 2011</a></li></ul><!-- .xoxo .archives --></div></div>
		
	</div><!-- #secondary .aside -->


	</div><!-- #container -->

	<div id="footer-container">

		
		<div id="footer">

			<div class="footer-insert"><p class="copyright">Copyright &#169; 2012 <a class="site-link" href="http://tech.loku.com" title="Loku Tech" rel="home"><span>Loku Tech</span></a>.</p>

<p class="credit">Powered by <a class="wp-link" href="http://wordpress.org" title="Powered by WordPress, state-of-the-art semantic personal publishing platform"><span>WordPress</span></a> and <a class="theme-link" href="http://themehybrid.com/themes/hybrid" title="Hybrid"><span>Hybrid</span></a>.</p></div>
		</div><!-- #footer -->

		
	</div><!-- #footer-container -->

</div><!-- #body-container -->

<script type='text/javascript' src='../../../../wp-content/themes/hybrid/library/js/drop-downs.js%3Fver=1.4'></script>

</body>
</html>