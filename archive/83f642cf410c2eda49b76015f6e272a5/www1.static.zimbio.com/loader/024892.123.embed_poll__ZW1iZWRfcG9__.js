var PollWidget={pollClass:"pollWidget",pollIdPrefix:"pollwidget_",pollOptionClass:"pollOption",votePollUrl:"/polls/ajax_poll_vote",votePollFormUrl:"/polls/ajax_poll_vote_form",pollGuid:"",pollList:[],is_mobile:0,init:function(A){PollWidget.setOptions();if(A){is_mobile=A.is_mobile}},setOptions:function(){var B=document.getElementsByClassName(PollWidget.pollClass);var C=Event.observe;for(var A=0;A<B.length;A++){poll=B[A];options=poll.getElementsByClassName("pollOption");for(var E=0;E<options.length;E++){var D=options[E];if(D){if(PollWidget.is_mobile){C(D,"touchend",PollWidget.voteOption)}else{C(D,"mouseover",PollWidget.hoverOption);C(D,"mouseout",PollWidget.hoverOffOption)}C(D,"click",PollWidget.voteOption)}}}},setAction:function(B,C){var A=Event.observe;if(PollWidget.is_mobile){A(C,"touchend",PollWidget.voteOption)}else{A(C,"mouseout",PollWidget.hoverOffOption)}A(C,"click",PollWidget.voteOption)},hoverOption:function(B){var C=this.id;var A=$(C).className;$(C).className=(/chosenOption/.test(A))?"pollOption chosenOption displayOption":"pollOption displayOption"},hoverOffOption:function(B){var C=this.id;var A=$(C).className;$(C).className=(/chosenOption/.test(A))?"pollOption chosenOption":"pollOption"},pollVoteSubmit:function(){var D=$("pollVoteForm_"+PollWidget.pollGuid).getElementsByTagName("input"),F={},B;for(var C=0,A=D.length;C<A;C++){F[D[C].name]=D[C].value}var E=new Ajax.Request("/polls/ajax_poll_vote",{method:"POST",parameters:F,onFailure:function(){},onSuccess:function(G){PollWidget.clearOptions(PollWidget.pollGuid);PollWidget.showVotedResults(G.responseText)}})},voteOption:function(E){var F=this.id;if(/chosenOption/.test(this.className)){return }var D=this.parentNode.parentNode.id.replace(PollWidget.pollIdPrefix,"");PollWidget.pollGuid=D;var C=F.replace("option_","");var B=document.location.toString();if(/articles/.test(B)){var A=B.split("/")[5]}else{var A=""}params={"poll_guid":D,"id":C,"article_guid":A};new Ajax.Request(PollWidget.votePollFormUrl,{method:"get",onError:function(){alert("error")},onSuccess:function(H){var J=document.createElement("div");J.innerHTML=H.responseText;document.body.appendChild(J);var G=$("pollVoteForm");G.id="pollVoteForm_"+D;var I=G.getElementsByTagName("input");I[2].setAttribute("value",D);I[3].setAttribute("value",C);I[4].setAttribute("value",A);PollWidget.pollVoteSubmit()}})},showVotedResults:function(json){var obj=eval("("+json+")")||null;if(obj.errors){return }if(obj.poll_votes){$("viewTotalLink|"+obj.poll_guid).innerHTML="Total Votes: "+obj.poll_votes}if(obj.option_results){for(var op=0;op<obj.option_results.length;op++){var option=obj.option_results[op];var option_id=option[0];var percentage=option[1];var bar_width=option[2];var bar_color="whitePageResultsBar";$("pollResult"+option_id).innerHTML='<div class="resultsBarLimit"><div class="bar_graph '+bar_color+'" style="width:'+bar_width+'px"></div></div><div class="results_percent">'+percentage+'%</div><div class="clear"></div>';if(!obj.chosen_option){$("pollResult"+option_id).style.display="none"}else{PollWidget.showVotes(obj.poll_guid)}}}if(obj.chosen_option){PollWidget.showVotes(obj.poll_guid);$("option_"+obj.chosen_option).className="pollOption chosenOption";$("optionImg_"+obj.chosen_option).className="pollImageBody votedOpacity"}},showVotes:function(A){var B=$("pollwidget_"+A).getElementsByClassName("pollResultBar");for(var D=0;D<B.length;D++){var C=B[D];C.style.display="block"}$("viewResultLink|"+A).style.display="none";$("viewTotalLink|"+A).style.display="block";$("viewSeeMore|"+A).style.display="block"},clearOptions:function(C){var E=$(PollWidget.pollIdPrefix+C);var H=E.getElementsByClassName("pollOption chosenOption");for(var G=0;G<H.length;G++){voted_tr=H[G];voted_tr.className="pollOption";var A=voted_tr.getElementsByClassName("pollImageBody votedOpacity");for(var D=0;D<A.length;D++){A[D].className="pollImageBody"}var F=voted_tr.getElementsByClassName("pollVoted");for(var B=0;B<F.length;B++){F[B].style.display="none"}}}}