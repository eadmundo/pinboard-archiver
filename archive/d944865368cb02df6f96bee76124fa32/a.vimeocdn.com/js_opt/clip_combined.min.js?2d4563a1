(function(){var a=Element.NativeEvents,b=window.location,c=b.pathname,d=window.history,e="pushState"in d,f=e?"popstate":"hashchange";this.History=new new Class({Implements:[Class.Binds,Events],_loc_history:[b],hash:null,pathname:null,initialize:function(){a[f]=e?2:1;window.addEvent(f,this.bound("pop"));this.hash=this.getLocation().hash;if(!e&&!("onhashchange"in window))this.timer=this.periodical.periodical(200,this)},push:function(a,c,f){if(e)d.pushState(f||null,c||null,a);else if(this.hashFallback)b.hash=
a;else return window.location=a,!1;this.onChange(a,f)},pushHash:function(a){var c=this.getLocation().pathname||b.pathname;if(e)a=c+"#"+a;else if(this.hashFallback)a="#"+c+"#"+a;else return b.hash=a,!1;this.push(a)},replace:e?function(a,b,c){d.replaceState(c||null,b||null,a)}:function(a){this.hash="#"+a;this.push(a)},pop:e?function(a){var b=this.getLocation().href;this.hash=this.getLocation().hash;if(b==c)c=null;else this.onChange(b,a.event.state)}:function(){var a=this.getLocation().hash;if(this.hash!=
a)this.hash=a,this.onChange((a||null).substr(1))},back:function(){d.back()},forward:function(){d.forward()},onChange:function(a,b){this._loc_history.unshift(this.getLocation());var c=this._loc_history[1],d=this._loc_history[0];d.hash!=c.hash&&this.fireEvent("hashchange",[a,b,d,{hash_change:!0,path_change:d.pathname!=c.pathname}]);d.pathname+d.search!=c.pathname+c.search&&this.fireEvent("change",[a,b,d,{hash_change:d.hash!=c.hash,path_change:!0}])},getPath:function(){return this.getLocation().pathname},
hasPushState:function(){return e},periodical:function(){this.hash!=b.hash&&this.pop()},pageLoad:function(){if(e===!1&&this.hash)this.onChange(this.hash.substr(1))},getHash:function(){return this.hash},getPathName:function(){return this.getLocation().pathname},getLocation:function(){var a=b.hash.toString().split("#");a.shift();var c=new URI(b);return{hash:e?b.hash:a[1],host:b.host,hostname:b.hostname,href:b.href,pathname:e?b.pathname:a[0],search:(c.parsed.query?"?":"")+(c.parsed.query||"")}}})})();
var ScrollSpy=new Class({Implements:[Options,Events],options:{container:window,max:0,min:0,mode:"vertical"},initialize:function(a){this.setOptions(a);this.container=document.id(this.options.container);this.enters=this.leaves=0;this.inside=!1;var b=this;this.listener=function(a){var d=b.container.getScroll(),e=d[b.options.mode==="vertical"?"y":"x"];if(e>=b.options.min&&(b.options.max===0||e<=b.options.max)){if(!b.inside)b.inside=!0,b.enters++,b.fireEvent("enter",[d,b.enters,a]);b.fireEvent("tick",
[d,b.inside,b.enters,b.leaves,a])}else if(b.inside)b.inside=!1,b.leaves++,b.fireEvent("leave",[d,b.leaves,a]);b.fireEvent("scroll",[d,b.inside,b.enters,b.leaves,a])};this.addListener()},start:function(){this.container.addEvent("scroll",this.listener)},stop:function(){this.container.removeEvent("scroll",this.listener)},addListener:function(){this.start()}}),ThrottledScrollSpy=new Class({Extends:ScrollSpy,has_scrolled:!0,polling:!1,interval:250,e:null,initialize:function(a){this.bound={setHasScrolled:this.setHasScrolled.bind(this)};
this.parent(a);setTimeout(this.checkScrollPosition.bind(this),this.interval)},checkScrollPosition:function(){if(this.has_scrolled)this.listener(this.e),this.e=null,this.has_scrolled=!1;this.polling&&setTimeout(this.checkScrollPosition.bind(this),this.interval)},stopPolling:function(){this.polling=!1},setHasScrolled:function(a){this.e=a;this.has_scrolled=!0;if(!this.polling)return this.polling=!0,this.checkScrollPosition();setTimeout(this.stopPolling.bind(this),1E3)},start:function(){this.container.addEvent("scroll",
this.bound.setHasScrolled)},stop:function(){this.container.removeEvent("scroll",this.bound.setHasScrolled)}});
(function(){window.$clamp=function(a,b){function c(a,b){if(!j.getComputedStyle)j.getComputedStyle=function(a){this.el=a;this.getPropertyValue=function(b){var c=/(\-([a-z]){1})/g;b=="float"&&(b="styleFloat");c.test(b)&&(b=b.replace(c,function(a,b,c){return c.toUpperCase()}));return a.currentStyle&&a.currentStyle[b]?a.currentStyle[b]:null};return this};return j.getComputedStyle(a,null).getPropertyValue(b)}function d(b){var b=b||a.clientHeight,c=e(a);return Math.max(Math.floor(b/c),0)}function e(a){var b=
c(a,"line-height");b=="normal"&&(b=parseInt(c(a,"font-size"))*1.2);return parseInt(b)}function f(b){return b.lastChild&&b.lastChild.children&&b.lastChild.children.length>0?f(Array.prototype.slice.call(b.children).pop()):!b.lastChild||!b.lastChild.nodeValue||b.lastChild.nodeValue==""||b.lastChild.nodeValue=="\u2026"?(b.lastChild.parentNode.removeChild(b.lastChild),f(a)):b.lastChild}function g(b,c){if(c){var d=b.nodeValue.replace(/\u2026/,"");k||(n=p.length>0?p.shift():"",k=d.split(n));k.length>1?(q=
k.pop(),h(b,k.join(n))):k=null;if(k){if(a.clientHeight<=c)if(p.length>=0&&n!="")h(b,k.join(n)+n+q),k=null;else return!1}else n==""&&(h(b,""),b=f(a),p=m.splitOnChars.slice(0),n=p[0],q=k=null);m.animate?setTimeout(function(){g(b,c)},m.animate===!0?10:m.animate):g(b,c)}}function h(a,b){a.nodeValue=b+"\u2026"}var b=b||{},j=window,m={clamp:b.clamp||2,useNativeClamp:typeof b.useNativeClamp!="undefined"?b.useNativeClamp:!0,splitOnChars:b.splitOnChars||[".","-","\u2013","\u2014"," "],animate:b.animate||!1},
o=a.style,s=typeof a.style.webkitLineClamp!="undefined",l=m.clamp,r=l.indexOf&&(l.indexOf("px")>-1||l.indexOf("em")>-1),p=m.splitOnChars.slice(0),n=p[0],k,q;l=="auto"?l=d():r&&(l=d(parseInt(l)));if(s&&m.useNativeClamp){if(o.overflow="hidden",o.textOverflow="ellipsis",o.webkitBoxOrient="vertical",o.display="-webkit-box",o.webkitLineClamp=l,r)o.height=m.clamp+"px"}else o=e(a)*l,g(f(a),o)}})();
function google_ad_request_done(a){var b=a.length;if(!(b<=0)&&$("google_afc_ads")){var c="";for(i=0;i<b;i++)c+='<a href="'+a[i].url+'" style="text-decoration:none"><span class="line_1">'+a[i].line1+'</span><span class="line_2">'+a[i].line2+" "+a[i].line3+'</span><span class="line_3">'+a[i].visible_url+"</span></a>";c?$("google_afc_ads").set("html","<h4>Sponsored Links</h4>"+c).addClass("ad-loaded"):$("google_afc_ads").dispose()}}
var Gallery=new Class({Implements:[Options,Events],options:{className:"photo_booth",loop:!1,moveNextOnMain:!0,mainImage:null,prevBtn:null,nextBtn:null,closeBtn:null,canClose:!0,hideNavigation:!0,onImageLoaded:function(){},onChange:function(){}},initialize:function(a,b,c){if($(a)===null)throw Error("Invalid element");if(b.length===0)throw Error("No image paths supplied");this.setOptions(c);this.container=$(a);this.sourceImages=b;this.createElements(b);this.attachEvents()},createElements:function(a){if(!this.navigation)this.navigation=
(new Element("nav")).inject(this.container),this.navigation.set("tween",{property:"opacity",duration:125,transition:Fx.Transitions.Sine.easeOut}),this.navigation.tween(0);this.currentIndex=0;this.mainImage=this.options.mainImage||this.createMainImage();this.prevBtn=this.options.prevBtn||this.createButton("btn btn_gray btn_prev","&#9668;");this.nextBtn=this.options.nextBtn||this.createButton("btn btn_gray btn_next","&#9658;");this.loadedImages=[];this.images=new Asset.images(a,{onProgress:this.onImageLoaded.bind(this)});
if(this.options.canClose)this.closeBtn=this.options.closeBtn||this.createButton("btn btn_red btn_close","Close");a.length===1&&(this.prevBtn.hide(),this.nextBtn.hide());this.prevBtn.addClass("btn_disabled")},attachEvents:function(){this.prevBtn.addEvent("click",this.onPrevClick.bind(this));this.nextBtn.addEvent("click",this.onNextClick.bind(this));this.options.moveNextOnMain&&this.mainImage.addEvent("click",this.onNextClick.bind(this));this.options.canClose&&this.closeBtn.addEvent("click",this.onCloseClick.bind(this));
this.options.hideNavigation&&(this.container.addEvent("mouseenter",this.onImageOver.bind(this)),this.container.addEvent("mouseleave",this.onImageOut.bind(this)))},createMainImage:function(){return(new Element("img",{"class":"main_portrait"})).inject(this.container)},createButton:function(a,b){return(new Element("a",{"class":a,html:b})).inject(this.navigation)},setSource:function(a){try{this.mainImage.set("src",a)}catch(b){this.mainImage.set("src",this.images[0].src)}},getMainImage:function(){return this.mainImage},
onImageLoaded:function(a,b){b===0&&this.mainImage.set("src",this.images[0].src);this.loadedImages.push(b);this.fireEvent("onImageLoaded")},onImageOver:function(){this.options.hideNavigation&&this.navigation.tween(1)},onImageOut:function(){this.options.hideNavigation&&this.navigation.tween(0)},onPrevClick:function(a){a.preventDefault();this.prev()},onNextClick:function(a){a.preventDefault();this.next()},onCloseClick:function(a){a.preventDefault();this.hide()},show:function(){this.container.show()},
hide:function(){this.container.hide()},load:function(a){var b=this.images[a].src||this.sourceImages[a];this.totalImages=this.images.length;this.prevBtn.removeClass("btn_disabled");this.nextBtn.removeClass("btn_disabled");this.loadedImages.contains(a)?this.setSource(b,a):new Asset.image(b,{onComplete:function(){this.loadedImages.push(a);this.setSource(b)}.bind(this)});this.options.loop||(a===0?this.prevBtn.addClass("btn_disabled"):a===this.totalImages-1&&this.nextBtn.addClass("btn_disabled"));this.currentIndex=
a;this.fireEvent("onChange",a)},prev:function(){this.currentIndex--;this.currentIndex<0?this.options.loop?(this.currentIndex=this.images.length-1,this.load(this.currentIndex)):this.currentIndex=0:this.load(this.currentIndex)},next:function(){this.currentIndex++;this.currentIndex>=this.images.length?this.options.loop?(this.currentIndex=0,this.load(this.currentIndex)):this.currentIndex=this.images.length-1:this.load(this.currentIndex)}}),Brozar=new Class({Implements:[Options,Events],options:{url:null,
thumbnailWidth:180,widthBuffer:110,onClipSelected:function(){}},cache:new Hash,pageNumber:1,itemsPerPage:10,itemOffset:null,scrollDirection:null,scrollActive:!1,RESIZE_UPDATE_INTERVAL:500,initialize:function(a,b){this.container=$(a);if(this.container===null)throw Error("Invalid element");this.setOptions(b);this.attachEvents();this.itemsPerPage=this.calculateItemsPerPage();this.lastWindowWidth=$(window).getSize().x;this.request=new Request.HTML({url:this.options.url,method:"get",onSuccess:function(a,
b,e){this.processHtml(e);this.cache.set(this.getKey(),e)}.bind(this)});this.loadPage(!0)},attachEvents:function(){this.bound={onWindowResize:this.onWindowResize.bind(this)};this.container.addEvent("click:relay(a)",this.onBrozarClick.bind(this))},calculateVisibleItemsPerPage:function(){var a=(this.container.getSize().x-this.options.widthBuffer)/this.options.thumbnailWidth;return a%1>0.9?Math.ceil(a):Math.floor(a)},calculateItemsPerPage:function(){var a=this.container.getSize().x-this.options.widthBuffer;
return Math.ceil(a/this.options.thumbnailWidth)},getKey:function(){var a=Cookie.read("stream"),b=$("streams");return a!==null?a+":"+this.pageNumber:b!==null?b.get("data-stream")+":"+this.pageNumber:this.pageNumber},loadPage:function(a){var b=a?null:this.cache.get(this.getKey());b!==null?this.processHtml(b):this.request.send({data:{action:"brozar",page:this.pageNumber,page_size:this.itemsPerPage,offset:this.itemOffset,initial_load:a||null}})},setClipPositions:function(){var a=$("clips");a!==null&&
(this.purgeData(a),a.setStyle("left","0px"))},purgeData:function(a){var a=a.getChildren(),b=this.scrollDirection==="right"?this.calculateVisibleItemsPerPage():this.itemsPerPage;a.length>this.itemsPerPage&&a.each(function(a,d){this.scrollDirection==="left"&&d>=b?a.destroy():this.scrollDirection==="right"&&d<b&&a.destroy()}.bind(this))},setActiveClip:function(){var a=$("clip_"+ClipConfig.clip_id),b=$("clips");a!==null&&(b.getChildren().removeClass("selected"),a.addClass("selected"))},processHtml:function(a){var b=
$("streams"),c=$("clips"),d,e,f,g,h;if(this.scrollDirection===null){if(this.container.set("html",a),this.setClipPositions(),b!==null&&!Browser.ie&&(a=$("streams"),e=b.getElement(".couchmode"),g=b.getElement(".seeall"),d=a.get("data-stream"),f=a.getElement(".couchmode"),h=a.getElement(".seeall"),b.replaces(a),b.set("data-stream",d),e!==null&&e.destroy(),g!==null&&g.destroy(),h!==null&&h.inject(b,"top"),f!==null&&f.inject(b,"top")),c!==null)this.pageNumber=c.get("data-page")}else{d=$("arrow_left");
e=$("arrow_right");b=Elements.from(a);b[2].replaces(d);b[3].replaces(e);a=b[1].getFirst().getChildren();d=a.length;b=null;if(this.scrollDirection==="left"){for(b=d-1;b>=0;b--)a[b].inject(c,"top");c.setStyle("left",-(this.options.thumbnailWidth*this.itemsPerPage))}else a.each(function(a){a.inject(c)});a=null;this.scroll()}this.setActiveClip();c&&c.getFirst().getElement("a").focus();this.pageNumber===1&&c!==null?window.addEvent("resize:pause("+this.RESIZE_UPDATE_INTERVAL+")",this.bound.onWindowResize):
window.removeEvent("resize",this.bound.onWindowResize)},scroll:function(){var a=$("clips"),b=this.calculateVisibleItemsPerPage()*this.options.thumbnailWidth,b=this.scrollDirection==="left"?0:-b;(new Fx.Tween(a,{unit:"px",property:"left",duration:250,transition:Fx.Transitions.Expo.easeInOut,onComplete:function(){this.setClipPositions.apply(this,arguments);this.scrollActive=!1}.bind(this)})).start(b)},onWindowResize:function(){var a=$(window).getSize().x;if(a!==this.lastWindowWidth)this.cache.empty(),
this.itemsPerPage=this.calculateItemsPerPage(),this.scrollDirection=this.itemOffset=null,this.lastWindowWidth=a,Cookie.write("stream",$("streams").get("data-stream"),{domain:vimeo.domain,path:"/"}),this.loadPage()},onBrozarClick:function(a,b){if(b.getParent("li.selected"))a.stop();else if(!b.hasClass("more"))if(b.getParent("ol"))this.onClipClick(a,b);else if(b.getParent(".scroll"))this.onPaginationClick(a,b);else if(b.getParent("#streams"))this.onStreamClick(a,b)},onClipClick:function(a,b){var c=
$("streams").get("data-stream");Cookie.write("stream",c,{domain:vimeo.domain,path:"/"});a.stop();$("clips").getChildren().removeClass("selected");b.getParent().addClass("selected");c.split(":")[0]!=="clips"&&this.cache.getKeys().each(function(a){a.contains("clips")&&this.cache.erase(a)}.bind(this));c.split(":")[0]!=="related"&&this.cache.getKeys().each(function(a){a.contains("related")&&this.cache.erase(a)}.bind(this));this.fireEvent("onClipSelected",[b.get("href")])},onPaginationClick:function(a,
b){a.stop();if(!this.scrollActive)this.scrollActive=!0,this.pageNumber=b.get("data-page"),this.itemOffset=b.get("data-offset")||null,this.scrollDirection=b.getParent().hasClass("arrow_left")?"left":"right",_gaq.push(["_trackEvent","brozar","pagination",this.scrollDirection,0,!0]),Cookie.write("stream",$("streams").get("data-stream"),{domain:vimeo.domain,path:"/"}),this.loadPage()},onStreamClick:function(a,b){a.stop();this.pageNumber=1;this.scrollDirection=this.itemOffset=null;Cookie.write("stream",
b.get("data-stream"),{domain:vimeo.domain,path:"/"});b.getParent().getElements(".stream").removeClass("active");b.addClass("active");this.loadPage()}}),Comment={page:1,hashtag:null,group_id:0,request_max:5,requests_made:0,txt_see_more_comments:"",reply_requests:{},initialize:function(){Comment.comments=$("comments");typeof TimeUpdater!=="undefined"&&TimeUpdater.start();if(Comment.comments!==null)Comment.createRequest(),Comment.attachEvents(),Comment.hashtag=Hashtag.find()},createRequest:function(){Comment.request=
new Request.HTML({url:location.href,method:"get",onSuccess:Comment.onLoadSuccess,onRequest:Comment.onLoadRequest})},attachEvents:function(a){var a=$("comment"),b=$("sticky_comments"),c=$("comments");$("pagination")!==null&&c.addEvent("click:relay(#pagination a)",Comment.onLoadMoreClick);b&&b.addEvents({"mouseover:relay(.article)":Comment.onCommentOver,"mouseout:relay(.article)":Comment.onCommentOut,"click:relay(.actions a, .btn, .btn_reply)":Comment.onAction,"click:relay(.permalink)":Comment.onPermalinkClick});
c.addEvents({"mouseover:relay(.article)":Comment.onCommentOver,"mouseout:relay(.article)":Comment.onCommentOut,"click:relay(.actions a, .btn, .btn_reply)":Comment.onAction,"click:relay(.permalink)":Comment.onPermalinkClick});$("show_all_comments")&&$$("#show_all_comments a").addEvent("click",Comment.onShowAllCommentsClick);a!==null&&a.getElement("input")!==null&&Comment.setupAddComment()},getContext:function(){var a=window.ClipConfig?ClipConfig.context.toString().split(":"):null;return a?a:0},scrollToBottom:function(){(new Fx.Scroll(window)).toBottom()},
scrollToPagination:function(){Global.smoothScroll("pagination")},resetForm:function(a){a.retrieve("validator")!==null&&a.retrieve("validator").reset();a.reset();Comment.resetUrlField(a)},hideTools:function(a,b){var c=a.getElement(".comment_reply"),d=a.getElement(".comment_edit"),e=a.getElement(".comment_delete");b!=="reply"&&c!==null&&c.isDisplayed()?c.hide():b!=="edit"&&d!==null&&d.isDisplayed()?d.hide():b!=="delete"&&e!==null&&e.isDisplayed()&&e.hide()},setupAddComment:function(){var a=$("comment");
if(a){var b=Comment.getContext(),c=b[0],b=b[1];new Form.Validator(a);new Form.Request(a,null,{extraData:{version:Global.getVersion(),token:vimeo.xsrft,context_type:c,context_id:b},onSuccess:function(a,b,c,g){var h=$("comments").getElement("h2"),a=$("count"),b=$("comment"),c=$("sticky_comments"),j=!1,g=new Element("div",{html:g});if(g.getElement("article")&&(j=g.getElement("article").hasClass("sticky")))Global.scroll.toTop(),c.getParent().addClass("stickies_here");a===null&&h!==null?h.set("html",'<span id="count">'+
Copy.translate("count_comments",!1,{COUNT:1})+"</span>"):a!==null&&(h=a.get("text").toInt()+1,a.set("text",Copy.translate("count_comments",h!==1,{COUNT:h})));g.getElements("article").inject(j?c:b,j?"bottom":"before").setStyle("opacity",0).set("tween",{duration:250}).fade(1);Comment.resetForm(b)},onFailure:function(b){if(b.status===403)alert(Copy.dict.no_comments_for_you);else for(var c in JSON.decode(b.responseText))a.getElement(":input[name="+c+"]").addClass("validation-failed")}});a.getElement(".guidelines")&&
(a.getElement(".guidelines").removeEvents("click"),a.getElement(".guidelines").addEvent("click",function(a){a.stop();this.getParent("fieldset").getNext(".alert").toggle()}));Comment.setupUrlField(a)}},setupUrlField:function(a){a.getElements(".over-text").each(function(a){new OverText(a,{textOverride:a.get("data-placeholder")})})},resetUrlField:function(){OverText.update()},collapseReplyBoxes:function(){$$(".comment_reply").hide()},collapseCommentBox:function(){var a=$("comment");a.getElement(".comment").isVisible()&&
((new Element("a",{href:"#",html:Copy.translate("open_comment_box"),"class":"comment_toggle",events:{click:function(a){a.stop();Comment.openCommentBox();Comment.collapseReplyBoxes()}}})).inject(a),a.getElement(".comment").hide())},openCommentBox:function(){var a,b=$("comment");if(a=b.getElement(".comment_toggle"))b.getElement(".comment").show(),a.dispose(),Comment.resetUrlField.delay(50,this,[b])},setupAddReply:function(a,b){var c=$("comments"),d=b.getElement("form"),c=c.getElements("."+a.get("id")+
":not(.reply_form)").getLast(),e=a.get("id");Comment.resetForm(d);Comment.hideTools(a,"reply");b.toggle();Comment.collapseCommentBox();if(b.isDisplayed())if(b.getElement("textarea").focus(),new Form.Validator(d),typeof Comment.reply_requests[e]!=="undefined")Comment.reply_requests[e].target=c;else{var f=Comment.getContext(),g=f[0],f=f[1];Comment.reply_requests[e]=new Form.Request.Append(d,c,{extraData:{version:Global.getVersion(),token:vimeo.xsrft,context_type:g,context_id:f},inject:"after",onBeforeEffect:function(){Comment.hideTools(a);
b.toggle()},onSuccess:function(a){var b=$("count"),c;b!==null&&(c=b.get("text").toInt()+1,b.set("text",Copy.translate("count_comments",c!==1,{COUNT:c})));Comment.reply_requests[e].target=a;Comment.openCommentBox()},onFailure:function(a){if(a.status===403)alert(Copy.dict.no_comments_for_you);else for(var b in JSON.decode(a.responseText))d.getElement(":input[name="+b+"]").addClass("validation-failed")}})}Comment.resetUrlField(d)},setupEditComment:function(a){var b=a.getElement(".comment_edit"),c=b.getElement("form"),
d=a.getElement(".text");Comment.resetForm(c);Comment.hideTools(a,"edit");d.toggle();b.toggle();b.isDisplayed()&&(b.getElement("textarea").focus(),new Form.Validator(c),new Form.Request(c,a,{extraData:{token:vimeo.xsrft},onFailure:function(a){if(a.status===403)alert(Copy.dict.no_comments_for_you);else for(var b in JSON.decode(a.responseText))c.getElement(":input[name="+b+"]").addClass("validation-failed")}}))},setupDeleteComment:function(a){var b=$("comments"),c=a.getElement(".comment_delete"),d=a.getElement(".text"),
e=c.getElement("form");Comment.hideTools(a,"delete");d.show();c.toggle();c.isDisplayed()&&(c=Comment.getContext(),new Form.Request(e,null,{extraData:{token:vimeo.xsrft,context_type:c[0],context_id:c[1]},onSuccess:function(){var c=a,d=$("comments").getElement("h2"),e=$("count"),j=e!==null?e.get("text").toInt()-1:null;!a.hasClass("sticky")&&!a.hasClass("reply")&&(c=b.getElements("."+a.get("id")),c=(new Element("article",{"class":"main"})).surround(c));c.get("dissolve").chain(function(){this.destroy()}.bind(c)).dissolve();
j===0?d.set("html",Copy.dict.first_comment):e!==null&&e.set("text",Copy.translate("count_comments",j!==1,{COUNT:j}))}}))},onPermalinkClick:function(a){window.location.hash.toString().match(/^#?\/?[0-9]+/)!==null&&(a.stop(),Global.smoothScroll(this.get("href"),null,{set_hash:!0,full_href:!0}))},disableLoading:function(){var a=$("while_loading");a&&(a.getSiblings("a").hide(),a.show())},enableLoading:function(){var a=$("while_loading");a&&(a.hide(),a.getSiblings("a").show())},onLoadSuccess:function(a,
b,c){var a=$("pagination"),b=Elements.from(c),d={};if(a){b[0].hasClass("reply")&&a.getPrevious().hasClass("reply_form")&&a.getPrevious().destroy();Comment.page===1?($("comments").set("html",""),b.inject($("comments")),a.removeClass("hide"),Comment.page++):b.inject(a,"before");if(!c.contains("pagination"))for(;a.getNext().get("id")!=="comment";)a.getNext().destroy();a.destroy()}else d.last_page=!0;Signal.comments.request.success.dispatch(d);Comment.enableLoading();window.Clip&&typeof Clip.checkCommentHash!==
"undefined"&&Clip.checkCommentHash();Comment.setupAddComment()},onLoadRequest:function(){Comment.disableLoading()},onLoadMoreClick:function(a){a&&a.stop();if(this.hasClass("disabled"))return!1;Comment.pager=this;Comment.page=this.get("data-page");Comment.request.send({data:{action:"comments",page:Comment.page}})},onCommentOver:function(){var a;(a=this.getElement(".comment_tools"))&&a.show()},onCommentOut:function(){var a=!0,b;this.getElements(".tool").each(function(b){b.isDisplayed()&&(a=!1)});a!==
!1&&(b=this.getElement(".comment_tools"))&&b.hide()},onAction:function(a){var b,c;this.hasClass("reply")?(a.stop(),b=this.getParent(".article"),a=$(b.get("data-parent-id")),c=this.getNext(".comment_reply"),Comment.collapseReplyBoxes(),Comment.setupAddReply(a,c),Comment.setupUrlField(b)):this.hasClass("edit")?(a.stop(),Comment.setupEditComment(this.getParent(".article"))):this.hasClass("delete")?(a.stop(),Comment.setupDeleteComment(this.getParent(".article"))):this.hasClass("cancel")&&(a.stop(),b=
this.getParent("form"),a=this.getParent(".article").getElement(".text"),a!==null&&a.show(),b.getParent().hide(),Comment.openCommentBox())},onHashtagFound:function(a){var b=a.getNext(".reply_form");Global.smoothScroll(a);Comment.search.stop();b&&(a=b.get("data-parent-id"),Comment.setupAddReply($(a),b.getElement(".comment_reply")),Comment.collapseCommentBox())},onHashtagNotFound:function(){Comment.requests_made<Comment.request_max&&(setTimeout(Comment.search.get,50),Comment.requests_made++)},onShowAllCommentsClick:function(a){a&&
a.stop();Comment.page=1;Comment.request.send({data:{action:"comments",page:1}});$("show_all_comments").addClass("loading")}};
Comment.search={is_running:!1,get:function(){Comment.scrollToPagination();Signal.comments.request.success.remove(Hashtag.find);Signal.comments.request.success.add(Hashtag.find);Comment.request.send({data:{action:"comments",page:++Comment.page}})},running:function(a){if(a!==null)Comment.search.is_running=a;return Comment.search.is_running},stop:function(){Signal.hashtag.found.remove(Comment.onHashtagNotFound);Signal.hashtag.not_found.remove(Comment.onHashtagNotFound);Signal.comments.request.success.remove(Hashtag.find)}};
window.addEvent("domready",function(){Hashtag.register(/comment_[0-9]+/);Signal.hashtag.found.add(Comment.onHashtagFound);Signal.hashtag.not_found.add(Comment.onHashtagNotFound);Comment.initialize();if(Hashtag.get(/comment_[0-9]+/))Comment.scrollToBottom(),Comment.search.running(!0),Comment.page=0});
var Share={storage:null,initialize:function(){var a=$("share_embed");Share.loadDependencies();Share.columns=a.getElements(".col");if(Share.columns.length>=2)Share.columnPadding=Share.columns[0].getStyle("padding-top").toInt()+Share.columns[0].getStyle("padding-bottom").toInt();if(Cookie.read("embed_preferences"))Share.storage=JSON.decode(Cookie.read("embed_preferences"));a.getElements(".toggle_box").each(function(a){new ToggleBox(a,{onToggle:function(){Share.equalize()}})});Share.equalize();$("message_input")&&
$("message_input").addEvent("keyup",this.onMessageUpdate)},loadDependencies:function(){Share.onForageLoaded()},equalize:function(){var a,b;if(Share.columns.length<2)return!1;Share.columns.each(function(a){a.erase("style")});Share.columns.each(function(c,d){a=c.measure(function(){return this.getSize().y});if(d===0||a>b)b=a-Share.columnPadding});Share.columns.each(function(a){a.setStyle("height",b+"px")});return!0},onForageLoaded:function(){Share.forage=new Forage.Share("fg",{addEmails:!$("fg").hasClass("no_email"),
form:"mailer",onUserAdded:function(){setTimeout(function(){Share.equalize()},50)},onUserRemoved:function(){setTimeout(function(){Share.equalize()},50)}});Global.lightbox.centerWindow();Global.shareLightbox&&Global.shareLightbox.centerWindow();Global.xsrfProtect()},onColorPickerLoaded:function(){var a;if($("embed_generator")){if(Share.storage)a=Share.storage.color;if($("color_picker_toggle"))Embed.colorPicker=new ColorPicker("color_picker_toggle",{initial_color:a||$("embed_color").get("value"),onUpdate:function(a){a=
a.hex.toLowerCase();Embed.customizations.colorInput.set("value",a);Embed.setColor(a)},onSelect:function(a){a=a.hex.toLowerCase();Embed.customizations.colorInput.set("value",a);Embed.setColor(a);Embed.refreshEmbedCode()}})}},onMessageUpdate:function(){$("message").set("text",this.value)}},Embed={customizations:{},warnings:{},originalValues:{},codeRequest:null,initialize:function(){if(!$("embed_generator"))return!1;Embed.clipId=$("embed_clip_id").get("value");Embed.textArea=$("embed_code");Embed.customizeView=
$("embed_customize");Embed.customizeToggle=$("embed_customize_toggle");Embed.codeToggles=$("embed_generator").getElements("a.embed_code_toggle");Embed.previewPlayer=$("embed_preview").getElement(['*[id*="player',Embed.clipId,'"]'].join(""));Embed.customizations={widthInput:$("embed_width"),heightInput:$("embed_height"),titleCheckbox:$("embed_title"),bylineCheckbox:$("embed_byline"),portraitCheckbox:$("embed_portrait"),badgeCheckbox:$("embed_badge"),autoplayCheckbox:$("embed_autoplay"),loopCheckbox:$("embed_loop"),
linkCheckbox:$("embed_link"),descriptionCheckbox:$("embed_description"),staticColors:$("embed_customize").getElements(".color_block"),colorInput:$("embed_color")};Embed.warnings={size:$("size_alert"),autoplay:$("autoplay_alert"),loop:$("loop_alert"),caption:$("text_alert"),link:$("link_alert"),description:$("description_alert"),link_description:$("link_description_alert")};Embed.originalValues={width:$("embed_orig_width").get("value"),height:$("embed_orig_height").get("value")};Embed.codeRequest=
new Request({url:"/embed",method:"get",link:"cancel",onSuccess:Embed.onEmbedCodeSuccess});$("embed_customize").getElements(".toggle_box").each(function(a){(new ToggleBox(a)).addEvent("onToggle",function(){Share.equalize()})});Share.onColorPickerLoaded();Embed.attachEvents();Embed.refreshEmbedCode();try{Singletonbox.centerWindow()}catch(a){}},attachEvents:function(){Object.each(Embed.customizations,function(a){$(a)&&$(a).addEvent("change",Embed.onOptionChange)});[Embed.customizations.widthInput,Embed.customizations.heightInput].each(function(a){a.addEvent("keydown",
Embed.onDimensionKeyDown);a.addEvent("blur",Embed.onDimensionBlur)});Embed.customizations.staticColors.addEvent("click",Embed.onStaticColorSelected);Embed.customizations.colorInput.addEvent("keydown",Embed.onColorKeyDown);Embed.textArea.addEvent("click",Embed.onTextAreaClick);$("old_code").addEvent("click",function(){Embed.refreshEmbedCode(!0)})},resetSize:function(){Embed.customizations.widthInput.set("value",Embed.originalValues.width);Embed.customizations.heightInput.set("value",Embed.originalValues.height)},
calculateSize:function(a){var b;switch(a){case "x":case "width":a=Embed.customizations.heightInput.get("value");b=Embed.originalValues.width/Embed.originalValues.height;break;case "y":case "height":a=Embed.customizations.widthInput.get("value");b=Embed.originalValues.height/Embed.originalValues.width;break;default:throw Error("Invalid direction");}return Math.round(a*b)},resetWarnings:function(){Object.each(Embed.warnings,function(a){$(a).hide()})},checkWarnings:function(){var a=Embed.customizations,
b=Embed.warnings;Embed.resetWarnings();a.autoplayCheckbox.get("checked")&&b.autoplay.show();a.loopCheckbox.get("checked")&&b.loop.show();if(a.linkCheckbox.get("checked")||a.descriptionCheckbox.get("checked"))b.caption.show(),a.descriptionCheckbox.get("checked")&&a.linkCheckbox.get("checked")?b.link_description.show("inline"):a.descriptionCheckbox.get("checked")?b.description.show("inline"):a.linkCheckbox.get("checked")&&b.link.show("inline");Share.equalize()},refreshEmbedCode:function(a){var b=Embed.customizations;
Embed.checkWarnings();Embed.savePreferences();Embed.codeRequest.send({data:{clip_id:Embed.clipId,width:b.widthInput.get("value"),height:b.heightInput.get("value"),title:b.titleCheckbox.get("checked")?1:0,byline:b.bylineCheckbox.get("checked")?1:0,portrait:b.portraitCheckbox.get("checked")?1:0,badge:b.badgeCheckbox&&b.badgeCheckbox.get("checked")?1:0,autoplay:b.autoplayCheckbox.get("checked")?1:0,loop:b.loopCheckbox.get("checked")?1:0,color:b.colorInput.get("value"),link:b.linkCheckbox.get("checked")?
1:0,caption:b.descriptionCheckbox.get("checked")?1:0,iframe:a===!0?!1:!0}});a===!0?$("code_notice").setStyle("visibility","hidden"):$("code_notice").setStyle("visibility","visible")},savePreferences:function(){var a=Embed.customizations,a=JSON.encode({width:a.widthInput.get("value").toInt(),title:a.titleCheckbox.get("checked")?1:0,byline:a.bylineCheckbox.get("checked")?1:0,badge:a.badgeCheckbox&&a.badgeCheckbox.get("checked")?1:0,portrait:a.portraitCheckbox.get("checked")?1:0,autoplay:a.autoplayCheckbox.get("checked")?
1:0,loop:a.loopCheckbox.get("checked")?1:0,color:a.colorInput.get("value"),link:a.linkCheckbox.get("checked")?1:0,caption:a.descriptionCheckbox.get("checked")?1:0});Cookie.write("embed_preferences",a,{domain:vimeo.domain,path:"/",duration:365})},refreshPreview:function(a){var b=Embed.customizations,c=a.get("checked");switch(a){case b.titleCheckbox:Embed.toggleElement("title",c);break;case b.bylineCheckbox:Embed.toggleElement("byline",c);break;case b.portraitCheckbox:Embed.toggleElement("portrait",
c);break;case b.badgeCheckbox:Embed.toggleElement("badge",c);break;default:throw Error("Invalid option supplied.");}},onTextAreaClick:function(a){this.get("data-ios")||(a.stop(),this.focus(),this.select())},onDimensionKeyDown:function(a){var b=this,c=a.code,d=a.key,e=Embed.customizations.widthInput,f=Embed.customizations.heightInput;(c>47&&c<58||c>95&&c<106)&&!a.shift||d==="delete"||d==="backspace"||d==="tab"||d==="left"||d==="right"||d==="up"||d==="down"?setTimeout(function(){b===e?f.set("value",
Embed.calculateSize("height")):e.set("value",Embed.calculateSize("width"))},50):a.preventDefault()},onDimensionBlur:function(){(Embed.customizations.widthInput.get("value")===""||Embed.customizations.heightInput.get("value")==="")&&Embed.resetSize()},onOptionChange:function(){var a=Embed.customizations;(this===a.titleCheckbox||this===a.bylineCheckbox||this===a.portraitCheckbox||this===a.badgeCheckbox)&&Embed.refreshPreview(this);Embed.refreshEmbedCode()},onStaticColorSelected:function(a){var b=["#",
this.get("data-hex")].join("");a.stop();Embed.customizations.colorInput.set("value",b);Embed.onOptionChange(null);Embed.colorPicker.setColor(b)},onColorKeyDown:function(a){var b=a.key,c=a.shift,d=b==="delete"||b==="backspace"||b==="tab"||b==="left"||b==="right"||b==="up"||b==="down",e=!c&&/[a-fA-F0-9]/.test(b);e||c&&b==="3"||d||a.preventDefault()},onEmbedCodeSuccess:function(a){Embed.textArea.set("value",a.clean());Share.equalize()},onPlayerLoaded:function(){},toggleElement:function(a,b){Embed.previewPlayer=
Embed.previewPlayer||$("embed_preview").getElement(['*[id*="player',Embed.clipId,'"]'].join(""));Embed.previewPlayer.api_toggleElement(a,b)},setColor:function(a){Embed.previewPlayer=Embed.previewPlayer||$("embed_preview").getElement(['*[id*="player',Embed.clipId,'"]'].join(""));a.substr(0,1)==="#"&&(a=a.substr(1));try{Embed.previewPlayer.api_changeColor(a)}catch(b){}}},Clip={STATUS_PENDING:"pending",STATUS_STARTING:"starting",STATUS_ACTIVE:"active",STATUS_FINISHING:"finishing",STATUS_FAILED:"failed",
STATUS_DONE:"retrieved",DEFAULT_HEIGHT:480,MINIMUM_HEIGHT:300,BROZAR_REVEAL_DELAY:1E3,buffer:{video:"",info:""},ribbon:{fx:null,target:null},adderStatusMessageTweenTimer:{},requestSuccess:0,activePlayer:null,cached_hash:null,photoPageUrls:null,brozar_timeout:null,player_events_enabled:!0,initialize:function(){var a=window.location;if(top!==self)top.location=self.location;!vimeo.cur_user&&window.location.hash.indexOf("signin")!==-1&&Singletonbox.open({url:"/log_in"});History.hasPushState()===!1&&History.getHash()&&
(new URI(History.getHash().substr(1))).go();History.addEvent("change",Clip.onHistoryChange);Clip.brozar_element=$("brozar");Clip.infoElement=$("info");Clip.extrasElement=$("extras");Clip.videoElement=$("video");Clip.vimeoHolderElement=Clip.videoElement.getElement(".vimeo_holder");Clip.createRequests();Clip.setupBrozar();Clip.setupInfo();Clip.setupDescription();Clip.setupPlayerSwitch();Clip.setupExtras();Clip.setupTranscodingStatus();Clip.setupKeyboardShortcuts();Clip.setupRibbon();Clip.setupScrollCheck();
Clip.setupPlayerEvents();Clip.setupTimeMouseover();$$("#info, #extras").addEvents({"click:relay(a.video_time)":Clip.onVideoTimeClick});Clip.DEFAULT_HEIGHT=Clip.vimeoHolderElement.getSize().y||Clip.DEFAULT_HEIGHT;Global.resize_callbacks.push(this.onWindowResize);Global.onWindowResize();Global.lightbox.addEvent("load",Clip.onDeleteClick);if($("change_settings")){if($("tools").getElement(".btn.stats").hasClass("btn_disabled"))return;Cookie.read("auto_load_stats")?Cookie.read("auto_load_stats")==="1"&&
Clip.loadStats():(Cookie.write("auto_load_stats","1",{domain:vimeo.domain,path:"/",duration:9999}),Clip.loadStats())}(a=(new URI(a)).get("data"))&&a.vindicia_vid&&Clip.loadTipjar(a.vindicia_vid,a.PayerID)},createRequests:function(){var a=$("tools");Clip.extrasRequest=new Request.HTML({method:"get",data:{action:"extras"},update:"extras",link:"cancel",timeout:1E4,onSuccess:function(){var a=$("gallery"),c=$("remove_credit"),d=Clip.extrasElement.getElement(".pivots");a!==null&&Clip.setupFlickrGallery(a);
c!==null&&c.addEvent("click",function(){Clip.removeClipCredit(this)});d.getChildren("li").length===1&&d.getElement("li").get("data-type")==="video"&&d.getElement("li").get("data-count")==="1"&&d.getParent("section").dispose();Comment.initialize();$("extras").getElement(".col_large").adopt($("google_afc_ads"),"bottom");Global.lightbox=new Lightbox("[data-lightbox]",{onLoad:Global.onLightboxLoad})},onFailure:function(){$("extras").getElement(".notice").show()},onTimeout:function(){$("extras").getElement(".notice").show()}});
Clip.createRequest("credit","credits_extras");Clip.createRequest("statsView","stats",{action:"stats"},{track_event:["_trackEvent","ajax","stats","clip"]});Clip.createRequest("stats",null,null,{url:"/stats",link:"cancel"},"JSON");Clip.createRequest("download","download",{action:"download"});Clip.createRequest("adder","adder",{action:"adder"});Clip.createRequest("subscribe","follow",{action:"follow",token:vimeo.xsrft,is_clip:!0},null,"HTML","post");Clip.createRequest("navPrev",null,{action:"shortcut",
direction:"prev"},null,"JSON");Clip.createRequest("navNext",null,{action:"shortcut",direction:"next"},null,"JSON");Clip.createRequest("info",null,{action:"info"});Clip.createRequest("player","video");Clip.createRequest("tipjar","tipjar",{action:"tipjar"});if(a.getElement("a.accept"))Clip.groupPendingVideoRequest=new Request.JSON({method:"post",onSuccess:Clip.onGroupPendingVideoSuccess})},createRequest:function(a,b,c,d,e,f){e=e||"HTML";d=d||{};c=c||{};f=f||"get";b&&(d=Object.merge(d,{update:b}));return Clip[a+
"Request"]=new Request[e](Object.merge(d,{method:f,data:c,timeout:12E4,onSend:Clip["on"+a.capitalize()+"RequestSend"]||Clip.noop,onRequest:Clip["on"+a.capitalize()+"RequestRequest"]||Clip.noop,onFailure:Clip["on"+a.capitalize()+"RequestFailure"]||Clip.noop,onSuccess:Clip["on"+a.capitalize()+"RequestSuccess"]||Clip.noop,onTimeout:Clip["on"+a.capitalize()+"RequestTimeout"]||Clip.noop}))},setupPlayerEvents:function(){function a(a,b){var e;a.set("text",a.get("text").replace(/([\d,]+)/,function(a,c){e=
parseInt(c.replace(/\D/g,""),10)+b;return e.toString().replace(/[^\d\.]/g,"").split("").reverse().join("").replace(/(?!\d+\.)(\d\d\d)(?=\d+)/g,"$1,").split("").reverse().join("")}).replace(/(like)s?/i,function(a,b){return e===1?b:b+"s"}))}var b;window.flash_like_it=window.like_clip=function(c){var d=$("likes_extras"),e=new Date;if(c.like_it){c=Elements.from('<li><a href="{url}" title="{display_name}"><img src="{image_url}" alt="" class="portrait portrait_sm"><p><span>{display_name}</span><br><span class="meta"><time datetime="{nowISO}" title="{now}">just now</time></span></p></a></li>'.replace(/\{(\w+)\}/g,
function(a,b){switch(b){case "now":return e.toString();case "nowISO":return e.toISOString();case "image_url":return vimeo.cur_user.image_url["30"];default:return vimeo.cur_user[b]}}));if(d===null){var d=$("credits_extras"),f=$("extras_panel"),g=Elements.from('<section class="block buffer" id="likes_extras"><h4 class="red">0 Likes</h4><ul class="people"></ul></section>');d!==null?g.inject(d,"after"):g.inject(f,"top");d=$("likes_extras")}else if(d.style.display==="none"){d.show();d.getElement("time").set("datetime",
e.toISOString()).set("title",e.toString()).set("text",Copy.dict.just_now);return}f=d.getElement("ul");g=parseInt(f.get("data-max-likes"),10);g===f.getElements("li").length&&(b=f.getElement("li:last-child").dispose(),f.getElement("li:last-child").addClass("last"));c.inject(f,"top");g=d.getElement("h4");a(g,1);c.inject(f,"top")}else d!==null&&(d.getElements("li").length<=1?d.hide():(f=d.getElement("ul"),c=d.getElement("a[href="+vimeo.cur_user.url+"]").getParent("li"),g=d.getElement("h4"),g=parseInt(f.get("data-max-likes"),
10),g===f.getElements("li").length&&b&&(f.getElement("li:last-child").removeClass("last"),b.inject(f)),c.dispose(),g=d.getElement("h4"),a(g,-1)))}},setupBrozar:function(){var a;Clip.brozar_element?(Clip.brozar_loaded=!1,Clip.brozar_scroll=new Fx.Scroll(window,{duration:200,transition:Fx.Transitions.Expo.easeOut}),Clip.brozar_toggle=(new Element("a",{href:"javascript:void(0)",id:"toggle","class":"open",html:Copy.dict.more_videos,title:Copy.dict.see_more_videos})).addEvent("click",Clip.onBrozarToggleClick),
Browser.ie&&Browser.version<10?$(window).addEvent("resize",Clip.onViewportChange):Clip.brozar_toggle.addEvent("transitionend",Clip.onViewportChange),Clip.brozar_toggle.inject($("brozar_toggle_wrapper"),"top"),setTimeout(function(){Clip.brozar_element.inject(document.body,"top").show();a=Clip.brozar_element.getSize().y;Clip.brozar_scroll.set(0,a);Clip.brozar_spy=new ScrollSpy({container:window,min:-100,max:a-1,onEnter:function(){Clip.brozar_loaded||Clip.loadBrozar();Clip.brozar_toggle.hasClass("open")&&
Clip.brozar_toggle.removeClass("open").addClass("close");Clip.updateBrozarToggleText()},onLeave:function(){Clip.brozar_toggle.hasClass("close")&&Clip.brozar_toggle.removeClass("close").addClass("open");Clip.updateBrozarToggleText()}})},1E3),Clip.updateBrozarToggleText()):Clip.brozar_loaded=!0},onBrozarToggleClick:function(a){Clip.brozar_loaded||(_gaq.push(["_trackEvent","brozar","toggle","open",0,!0]),Clip.loadBrozar());this.removeClass("open").toggleClass("close");this.hasClass("close")||this.addClass("open");
Clip.updateBrozarToggleText();Clip.brozar_scroll.start(0,this.hasClass("close")?0:Clip.brozar_element.getSize().y);a.preventDefault()},updateBrozarToggleText:function(){var a=Clip.brozar_toggle,b=Copy.dict,c=$(window).getSize().x<1120,d;a.hasClass("close")?(d=b.hide_videos,b=c?b.hide_videos_abbr:b.hide_videos):(d=b.see_more_videos,b=c?b.more_videos_abbr:b.more_videos);a.set("html",b);a.set("title",d)},onViewportChange:function(){Clip.updateBrozarToggleText()},setupInfo:function(){Clip.infoElement.addEvent("click:relay(a)",
function(a){this.hasClass("download")?Clip.onDownloadClick.bind(this,a).call():this.hasClass("tipjar")?Clip.onTipjarClick.bind(this,a).call():this.hasClass("adder")?Clip.onAdderClick.bind(this,a).call():this.hasClass("stats")?Clip.onStatsClick.bind(this,a).call():this.id==="follow_btn"?Clip.onSubscribeClick.bind(this,a).call():this.hasClass("switch_player")?Clip.onPlayerSwitchClick.bind(this,a).call():this.hasClass("accept")?Clip.onPendingVideoClick.bind(this,a,"accept").call():this.hasClass("reject")&&
Clip.onPendingVideoClick.bind(this,a,"reject").call()});$("follow_btn")&&$("follow_btn").addEvents({mouseover:function(a){Clip.onSubscribeHover(a)},mouseout:function(a){Clip.onSubscribeHover(a)}})},setupDescription:function(){var a=$("info").getElement(".description"),b=a.getParent(),c,d;a.offsetHeight+50<a.scrollHeight?(d=b.getStyle("cursor"),b.setStyle("cursor","pointer"),c=(new Element("div",{"class":"more faux_link",html:Copy.dict.read_more+"&hellip;",title:a.get("data-expand-tooltip")})).inject(b,
"after"),c.addEvent("click:once",function(){a.removeClass("collapsed");c.destroy()}),b.addEvent("click:once",function(){b.setStyle("cursor",d);a.removeClass("collapsed");c.destroy()}),b.addEvent("mouseenter",function(){c.addClass("selected")}),b.addEvent("mouseleave",function(){c.removeClass("selected")})):a.removeClass("collapsed")},setupExtras:function(){if(Clip.extrasElement===null)Clip.extrasLoaded=!0;else{$("extras").getParent().adopt($("google_afc_ads"),"bottom");Clip.extrasLoaded=!1;Clip.loadingHtml=
Clip.loadingHtml||Clip.extrasElement.get("html");Clip.extrasElement.set("html",Clip.loadingHtml);if(Clip.extrasSpy)Clip.extrasSpy.stop(),Clip.extrasSpy=null;var a=0;if(Clip.brozar_element!==null)a=Clip.brozar_element.getSize().y;Clip.extrasSpy=new ThrottledScrollSpy({min:$("extras").getPosition().y-a-window.getSize().y,onEnter:Clip.onExtrasVisible})}},setupTranscodingStatus:function(){var a=$("transcoding_status"),b=new Request.JSON({url:ClipConfig.url,method:"get",initialDelay:1E3,delay:3E3,limit:5E3,
onSuccess:function(c){a.hide().getElements("p").hide();switch(c.status){case Clip.STATUS_PENDING:case Clip.STATUS_STARTING:$("transcoding_status_pending").show();a.show();break;case Clip.STATUS_ACTIVE:var d=$("transcoding_status_active"),e=d.getElements("var");e[0].set("text",c.percent);e[1].set("text",c.time_left);d.show();a.show();break;case Clip.STATUS_FINISHING:$("transcoding_status_finishing").show();a.show();break;case Clip.STATUS_FAILED:$("transcoding_status_failed").show();a.show();b.stopTimer();
break;case Clip.STATUS_DONE:$("transcoding_status_done").show();a.show();b.stopTimer();break;default:b.stopTimer()}},onFailure:function(){a.hide().getElements("p").hide();b.stopTimer()}});a!==null&&b.startTimer({action:"transcoding_status"})},setupPlayerSwitch:function(){if(Browser.Platform.name!="ios"&&(Browser.name=="chrome"||Browser.name=="safari"))Cookie.read("html_player")==="1"?$$('#tools a[data-player-type="flash"]').show():$$('#tools a[data-player-type="html"]').show()},setupKeyboardShortcuts:function(){Global.keyManager.register("left",
Clip.goPrev);Global.keyManager.register("right",Clip.goNext);Global.keyManager.register("m",function(){Clip.brozar_toggle.fireEvent("click")})},disableKeyboardShortcuts:function(){Global.keyManager.unregister("left",Clip.goPrev);Global.keyManager.unregister("right",Clip.goNext);Global.keyManager.unregister("m",function(){Clip.brozar_toggle.fireEvent("click")})},setupRibbon:function(){Clip.ribbon.target=Clip.videoElement.getElement(".private");Clip.ribbon.fx=new Fx.Elements(Clip.ribbon.target,{duration:500,
transition:"quad:in:out"})},setupTimeMouseover:function(){$$(".video_meta time").each(function(a){a.set("data-timeago",a.get("html"));a.set("data-title",a.get("title"));a.set("tween",{duration:50})});$$(".video_meta time").addEvents({mouseenter:function(){this.get("datetime");var a=this;a.set("title","");clearInterval(Clip.time_interval);Clip.time_interval=setTimeout(function(){a.fade("out").get("tween").chain(function(){a.set("html",a.get("data-title"));a.fade("in")})},1E3);return!1},mouseout:function(){this.get("data-timeago");
var a=this;a.set("title",a.get("data-title"));clearInterval(Clip.time_interval);Clip.time_interval=setTimeout(function(){a.fade("out").get("tween").chain(function(){a.set("html",a.get("data-timeago"));a.fade("in")})},1E3);return!1}})},onVideoTimeClick:function(a){a=parseInt(a.target.get("data-time"),10);Clip.activePlayer&&(Clip.activePlayer.api.send({method:"seekTo",value:a}),Clip.scrollToVideo())},waitForPlayer:function(a){Clip.activePlayer=a;Player.init.queue.push(Clip.onNewClipRequestSuccess);
Clip.player_events_enabled&&(a.api.send({method:"addEventListener",value:"play"}),a.api.send({method:"addEventListener",value:"finish"}),a.api.setCallback(function(a){switch(a.event){case "play":Clip.onPlayerPlay();break;case "finish":Clip.onPlayerFinish()}}))},disablePlayerEvents:function(a){Clip.player_events_enabled=!1;a&&(a.api.send({method:"removeEventListener",value:"play"}),a.api.send({method:"removeEventListener",value:"finish"}))},onPlayerPlay:function(){Clip.ribbon.target&&Clip.hideRibbon();
Clip.brozar_timeout&&clearTimeout(Clip.brozar_timeout);Clip.scrollToVideo()},scrollToVideo:function(){var a,b;a=Clip.videoElement.getPosition().y+Clip.videoElement.getSize().y;b=window.getScroll().y+window.getSize().y;(Clip.videoElement.getPosition().y<window.getScroll().y||a>b)&&Global.smoothScroll(Clip.videoElement,!0)},onPlayerFinish:function(){if(window.scrollY<$("video").getPosition().y&&$("comment")&&document.activeElement!==$("comment").getElement("textarea"))Clip.brozar_timeout=setTimeout(function(){Clip.brozar_scroll.toTop()},
Clip.BROZAR_REVEAL_DELAY),$(window).addEvent("scroll:once",function(){clearTimeout(Clip.brozar_timeout)})},hideRibbon:function(){Clip.ribbon.fx.start({0:{"margin-left":"-120px","margin-top":"-120px",opacity:0}})},showRibbon:function(){Clip.ribbon.fx.start({0:{"margin-left":"0","margin-top":"0",opacity:1}})},createCover:function(){if(!$("clip_cover")){var a=new Element("div",{id:"clip_cover",styles:{opacity:0.5,background:"#fff",position:"absolute",left:"0",top:"0",width:"100%",height:"100%","z-index":9999,
cursor:"wait"}});a.inject($("clip"),"bottom");return a}},removeCover:function(){var a;(a=$("clip_cover"))&&a.dispose()},destroyVideos:function(a){if(Clip.activePlayer)Clip.activePlayer=null;$$(".player").each(function(a){a=a.get("id").split("player_").join("player");a=window[a];try{a.player.destroy()}catch(c){}});a instanceof Function&&a()},loadBrozar:function(){Clip.brozar_loaded=!0;Clip.brozar=new Brozar(Clip.brozar_element,{url:ClipConfig.url,thumbnailWidth:180,widthBuffer:45,onClipSelected:function(a){History.push(a);
Clip.destroyVideos(function(){Global.smoothScroll("wrap",null,{set_hash:!1});Clip.brozar_toggle.removeClass("close").removeClass("lookatme").addClass("open");Clip.updateBrozarToggleText();Clip.createCover()})}})},loadExtras:function(){Clip.extrasLoaded=!0;Clip.extrasRequest.send({url:ClipConfig.url})},loadDownload:function(){var a=$("download");Clip.infoElement.getElements(".video_more").each(function(a){a.get("id")!=="download"&&a.hide()});a.set("html",'<p class="loading">'+Copy.dict.loading+"</p>").show();
Clip.downloadRequest.send({url:ClipConfig.url})},loadTipjar:function(a,b){var c=$("tipjar");Clip.infoElement.getElements(".video_more").each(function(a){a.get("id")!=="tipjar"&&a.hide()});var d=(new Element("p",{"class":"loading",html:Copy.dict.loading})).inject(c);c.show();if(vimeo.cur_user===null||vimeo.cur_user.id!==ClipConfig.user_id){var e="https://"+vimeo.url+"/cart/tipjar/"+ClipConfig.clip_id;a&&(e="https://"+vimeo.url+"/store/tipjar?vindicia_vid="+a+"&PayerID="+b);var f=new Element("a",{href:"javascript:void();",
"class":"undertaker",html:"&times;",events:{click:Clip.onTipjarClick}}),g=new Element("div",{"class":"tipjar_box box"});(new IFrame("tipjar_iframe",{src:e,styles:{width:915,height:0,border:"0"},events:{load:function(){f.inject(g,"top");d.dispose();this.setStyles({height:240,display:"block"})}}})).inject(g);g.inject(c);$$("#tools .btn:not(.tipjar)").removeClass("active");$$("#tools .tipjar").addClass("active");Clip.tipjarLoaded=!0}else Clip.tipjarRequest.send({url:ClipConfig.url})},loadAdder:function(){var a=
$("adder");Clip.infoElement.getElements(".video_more").each(function(a){a.get("id")!=="adder"&&a.hide()});a.set("html",'<p class="loading">'+Copy.dict.loading+"</p>").show();Clip.adderRequest.send({url:ClipConfig.url})},loadStats:function(){var a=$("stats");Clip.infoElement.getElements(".video_more").each(function(a){a.get("id")!=="stats"&&a.hide()});a.set("html",'<p class="loading">'+Copy.dict.loading+"</p>").show();Clip.statsViewRequest.send({url:ClipConfig.url})},loadSubscribe:function(){Clip.subscribe_btn=
Clip.subscribe_btn||$$("#tools #follow_btn")[0];var a=$("follow"),b=parseInt(Clip.subscribe_btn.get("data-subscribed"),10);Clip.subscribe_btn.set("data-subscribed",1-b);a.set("html",'<p class="loading">'+Copy.dict.loading+"</p>");b?Clip.subscribe_btn.removeClass("following").addClass("unfollowing"):(Clip.infoElement.getElements(".video_more").each(function(a){a.get("id")!=="follow"&&a.hide()}),a.show(),Clip.subscribe_btn.addClass("btn_disabled"));Clip.subscribeRequest.send({url:ClipConfig.user_url})},
toggleCollection:function(){var a=this.get("data-type"),b=this.get("checked"),c=null;this.get("data-permission")==="remove_only"&&this.set("disabled",!0);(new Request.JSON({url:ClipConfig.url,method:"post",data:{action:"toggle_collection",type:a,id:this.get("value"),toggle:b?"add":"remove",token:vimeo.xsrft},onSuccess:function(d){d.success?(c=this.getParent(".col").getElement(".message"),clearTimeout(Clip.adderStatusMessageTweenTimer[a]),c.hide().removeClass(b?"red":"green").addClass(b?"green":"red").set("html",
(b?Copy.dict.added:Copy.dict.removed)+"!").tween("opacity","1").setStyle("top",this.getPosition().y-c.getParent().getPosition().y-3+"px").show(),Clip.adderStatusMessageTweenTimer[a]=function(){c.tween("opacity",0)}.delay(3E3)):this.checked=!1;if(d.status==="group_adds_limit_reached"){var e=$("groups");e.getElements("input:not(:checked)").each(function(a){a.getNext("label").addClass("disabled");a.disabled=!0;e.getElement("p.tip").removeClass("hidden")})}else d.status==="group_adds_limit_below"&&(e=
$("groups"),e.getElements("input:disabled").each(function(a){a.getNext("label").removeClass("disabled");a.disabled=!1}))}.bind(this)})).send()},onHistoryChange:function(a,b,c){c.pathname!==""&&(!History.hasPushState()&&!a&&(a=History.getPathName()),Clip.loadClip(a))},loadClip:function(a){Clip.playerRequest.send({data:{clip_id:a.split("/").getLast(),server:vimeo.url,context:"clip_page",action:"player"}});Clip.infoRequest.send({url:a});Clip.downloadLoaded=!1;Clip.adderLoaded=!1;Clip.statsLoaded=!1},
getFlickrs:function(){var a=[],b;(b=$("flickr_thumbnails"))?b.getElements("img").each(function(b){a.push(b.get("data-large-image"))}):console.warn("Clip Page | Extras | No flickr_thumbnails element found.");return a},getPhotoUrls:function(){var a=[],b;(b=$("flickr_thumbnails"))&&b.getElements("img").each(function(b){a.push(b.get("data-pageurl"))});return a},setupFlickrGallery:function(a){var b=Clip.getFlickrs();b.length?(Clip.photoPageUrls=Clip.getPhotoUrls(),Clip.gallery=new Gallery(a,b,{mainImage:a.getElement(".main_portrait"),
canClose:!1,moveNextOnMain:!1,onChange:function(a){Clip.gallery.getMainImage().getParent("a").set("href",Clip.photoPageUrls[a])}}),$("flickr_thumbnails").getElements("img").each(function(a,b){a.addEvent("click",function(a){a.stop();Clip.gallery.load(b)})})):console.warn("Clip Page | Extras | Gallery not created from empty array of image paths.")},goPrev:function(){Clip.brozar_loaded&&Cookie.write("stream",$("streams").get("data-stream"),{domain:vimeo.domain,path:"/"});Clip.navPrevRequest.send({url:ClipConfig.url})},
goNext:function(){Clip.brozar_loaded&&Cookie.write("stream",$("streams").get("data-stream"),{domain:vimeo.domain,path:"/"});Clip.navNextRequest.send({url:ClipConfig.url})},removeClipCredit:function(a){a=a.getParent("li").get("id");confirm(Copy.dict.confirm_remove_credit)&&Clip.creditRequest.send({url:ClipConfig.url,data:{token:vimeo.xsrft,action:"toggle_clip_credits",credit_id:a}})},onDownloadClick:function(a){a.preventDefault();a=$("download");Clip.downloadLoaded?(Clip.infoElement.getElements(".video_more").each(function(a){a.get("id")!==
"download"&&a.hide()}),$$("#tools .btn:not(.download)").removeClass("active"),$$("#tools .download").toggleClass("active"),a.toggle()):Clip.loadDownload()},onTipjarClick:function(a){a.preventDefault();a=$("tipjar");Clip.tipjarLoaded?(Clip.infoElement.getElements(".video_more").each(function(a){a.get("id")!=="tipjar"&&a.hide()}),$$("#tools .btn:not(.tipjar)").removeClass("active"),$$("#tools .tipjar").toggleClass("active"),a.toggle()):Clip.loadTipjar()},onAdderClick:function(a){a.preventDefault();
a=$("adder");Clip.adderLoaded?(Clip.infoElement.getElements(".video_more").each(function(a){a.get("id")!=="adder"&&a.hide()}),$$("#tools .btn:not(.adder)").removeClass("active"),$$("#tools .adder").toggleClass("active"),a.toggle()):Clip.loadAdder()},onStatsClick:function(a){a.preventDefault();a=$("stats");Clip.statsLoaded?(Clip.infoElement.getElements(".video_more").each(function(a){a.get("id")!=="stats"&&a.hide()}),$$("#tools .btn:not(.stats)").removeClass("active"),$$("#tools .stats").toggleClass("active"),
a.toggle(),$("change_settings")&&Cookie.write("auto_load_stats",a.isVisible()?"1":"0",{domain:vimeo.domain,path:"/",duration:9999})):(Cookie.write("auto_load_stats","1",{domain:vimeo.domain,path:"/",duration:9999}),Clip.loadStats())},onSubscribeHover:function(a){Clip.subscribe_btn=Clip.subscribe_btn||$$("#tools #follow_btn")[0];!Clip.subscribe_btn.hasClass("active")&&!Clip.subscribing&&(a.type==="mouseover"?Clip.subscribe_btn.set("html",Clip.subscribe_btn.get("data-hover-text")):Clip.subscribe_btn.set("html",
Clip.subscribe_btn.get("data-btn-text")))},onSubscribeClick:function(a){a.preventDefault();if(!Clip.subscribing)Clip.subscribe_btn=Clip.subscribe_btn||$$("#tools #follow_btn")[0],$("follow"),parseInt(Clip.subscribe_btn.get("data-subscribed"),10),!Clip.subscribing&&!a.target.hasClass("active")?(Clip.subscribing=!0,Clip.loadSubscribe()):(Clip.subscribe_btn.removeClass("active").addClass("following").set("html",Clip.subscribe_btn.get("data-hover-text")),$("follow").hide(),Clip.subscribing=!1)},onDeleteClick:function(){if($$("#lightbox_container #lightbox_content #delete").length){var a=
$("delete_form"),b=$("delete_error");new Form.Validator(a);var c=$("delete_submit_btn");new Form.Request(a,"delete_submit_btn",{requestOptions:{url:location.href},extraData:{action:"delete"},onSend:function(){b.set("html","")},onSuccess:function(a,b,c,g){location.href=JSON.decode(g)},onFailure:function(c){a.fireEvent("reset");a.getElement(":input[name=password]").addClass("validation-failed");b.set("html",JSON.decode(c.responseText).password)}});a.addEvent("keyup:relay(input[name=password])",function(a,
b){b.get("value")!==""?c.set("disabled",!1):c.set("disabled",!0)})}},onPlayerSwitchClick:function(a){a.preventDefault();Cookie.write("html_player",this.get("data-player-type")==="html"?1:0,{domain:vimeo.domain,path:"/",duration:365});Clip.loadClip(window.location.pathname)},onExtrasVisible:function(){Clip.extrasSpy.stop();Clip.extrasLoaded||Clip.loadExtras()},setupScrollCheck:function(){if(Clip.scrollCheck)Clip.scrollCheck.stop(),Clip.scrollCheck=null;Clip.scrollCheck=new ScrollSpy({min:0,onEnter:Clip.scrollEvent})},
addAdSpy:function(){var a=0;if(Clip.brozar_element!==null)a=Clip.brozar_element.getSize().y;var b=$("ad");if($("google_afc_ads")!==null)Clip.adTextSpy=new ScrollSpy({min:$("google_afc_ads").getPosition().y-a-window.getSize().y,onEnter:Clip.adTextEvent});if(b!==null)Clip.adSpy=new ScrollSpy({min:$("ad").getPosition().y-a-window.getSize().y,onEnter:Clip.adEvent})},adEvent:function(){Clip.adSpy.stop();_gaq.push(["_trackEvent","scroll","ad_view","clip_page",0,!0])},adTextEvent:function(){Clip.adTextSpy.stop();
_gaq.push(["_trackEvent","scroll","text_ad_view","clip_page",0,!0])},scrollEvent:function(){Clip.scrollCheck.stop();_gaq.push(["_trackEvent","scroll","scroll","clip_page",0,!0])},onKeyboardShortcut:function(a){a&&History.push("/"+a)},onWindowResize:function(){var a=window.getHeight();a<Clip.DEFAULT_HEIGHT?Clip.vimeoHolderElement.setStyle("height",Math.max(Clip.MINIMUM_HEIGHT,Math.min(Clip.DEFAULT_HEIGHT,a))):Clip.vimeoHolderElement.getSize().y<Clip.DEFAULT_HEIGHT&&Clip.vimeoHolderElement.setStyle("height",
Clip.DEFAULT_HEIGHT)},onNewClipRequestSuccess:function(){if(++Clip.requestSuccess===2)Clip.onClipRequestReady(),Clip.requestSuccess=0},onClipRequestReady:function(){Clip.removeCover();document.title=(new Element("div",{html:ClipConfig.title})).get("text");Clip.infoElement.set("html",Clip.buffer.info);Clip.brozar_element!==null&&Clip.brozar_loaded&&($("stream_clips").set({html:ClipConfig.name+"&rsquo;s videos",title:ClipConfig.name+"&rsquo;s videos","data-stream":"clips:"+ClipConfig.user_id}),$("stream_related").set({html:"Related videos",
title:"related videos","data-stream":"related:"+ClipConfig.clip_id}),Clip.brozar.setActiveClip());Clip.setupExtras();Clip.setupRibbon();Clip.setupDescription();Clip.setupTranscodingStatus();Clip.setupPlayerSwitch()},onPendingVideoClick:function(a,b){Clip.groupPendingVideoRequest.send({data:{action:"pending_video",mode:b,token:vimeo.xsrft}})},onSubscribeRequestSuccess:function(){var a=parseInt(Clip.subscribe_btn.get("data-subscribed"),10),b=Clip.subscribe_btn.get("data-hover-text"),c=Clip.subscribe_btn.get("data-btn-text");
Clip.subscribe_btn.set("data-btn-text",Clip.subscribe_btn.get("data-alternate-text")).set("html",Clip.subscribe_btn.get("data-alternate-text")).set("data-hover-text",Clip.subscribe_btn.get("data-alternate-hover")).set("data-alternate-text",c).set("data-alternate-hover",b);a?($$("#tools .btn:not(#follow_btn)").removeClass("active"),$$("#tools #follow_btn").addClass("active"),$("follow").getElement("a.undertaker").addEvent("click",function(){$$("#tools #follow_btn").removeClass("active");$("follow").hide()}),
Clip.subscribe_btn.removeClass("follow").removeClass("btn_disabled").addClass("following")):($$("#tools #follow_btn").removeClass("active"),$("follow").hide(),Clip.subscribe_btn.removeClass("unfollowing").addClass("follow"));Clip.subscribing=!1},onStatsViewRequestSuccess:function(){$$("#tools .btn:not(.stats)").removeClass("active");$$("#tools .stats").addClass("active");$("stats").show();Clip.statsLoaded=!0;$("stats").getElement("a.undertaker").addEvent("click",function(a){Clip.onStatsClick(a)})},
onTipjarRequestSuccess:function(){Clip.tipjarLoaded=!0;$$("#tools .btn:not(.tipjar)").removeClass("active");$$("#tools .tipjar").addClass("active");$("tipjar").getElement("a.undertaker").addEvent("click",function(a){Clip.onTipjarClick(a)})},onDownloadRequestSuccess:function(){$$("#tools .btn:not(.download)").removeClass("active");$$("#tools .download").addClass("active");$("download").show();Clip.downloadLoaded=!0;$("download").getElement("a.undertaker").addEvent("click",function(a){Clip.onDownloadClick(a)})},
onAdderRequestSuccess:function(){var a=$("adder");$("groups");Clip.infoElement.addEvent("click:relay(.adder-check)",Clip.toggleCollection);$$("#tools .btn:not(.adder)").removeClass("active");$$("#tools .adder").addClass("active");a.getElement("form").equalize();a.show();a.getElements(".message").set("tween",{duration:250,link:"cancel",transition:Fx.Transitions.Quart.easeInOut});Clip.adderLoaded=!0;$("adder").getElement("a.undertaker").addEvent("click",function(a){Clip.onAdderClick(a)})},onNavPrevRequestRequest:function(){Clip.destroyVideos()},
onNavPrevRequestSuccess:function(){Clip.onKeyboardShortcut()},onNavNextRequestRequest:function(){Clip.destroyVideos()},onNavNextRequestSuccess:function(){Clip.onKeyboardShortcut()},onInfoRequestSuccess:function(a,b,c){Clip.buffer.info=c;Clip.onNewClipRequestSuccess()},onVideoRequestSuccess:function(){Clip.onNewClipRequestSuccess()},onGroupPendingVideoSuccess:function(a){var b=$("tools"),c=$("flag_link"),d=null;a.success===!0&&(b.getElement("a.accept")&&b.getElement("a.accept").destroy(),b.getElement("a.reject")&&
b.getElement("a.reject").destroy(),d=(new Element("span",{"class":"message pending_video_message "+(a.mode==="accept"?"green":"red"),html:a.mode==="accept"?"accepted!":"rejected!"})).set("tween",{onComplete:function(a){a.destroy()}}).inject(c,"before"),function(){d.get("tween").start("opacity",0)}.delay(3E3))},noop:function(){}};window.addEvent("domready",function(){Clip.initialize()});
